<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: javascript | null</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://yoursite.com/categories/javascript/">
<meta property="og:site_name">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="null" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">null</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-canvas" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/16/canvas/" class="article-date">
  <time datetime="2014-07-16T10:15:19.000Z" itemprop="datePublished">Jul 16 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/16/canvas/">Canvas API</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="概述">概述</h2>
<p>Canvas用于在网页展示图像，并且可以定制内容，基本上它是一个可以用JavaScript操作的位图（bitmap）。</p>
<p>Canvas API用于网页实时生成图像，JavaScript通过API来操作图像内容。这样做的优点是：减少HTTP请求数，减少下载的数据，加快网页载入时间，可以对图像进行实时处理。</p>
<p>使用前，首先需要新建一个canvas网页元素。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"myCanvas"</span> <span class="attribute">width</span>=<span class="value">"400"</span> <span class="attribute">height</span>=<span class="value">"200"</span>&gt;</span></div><div class="line">	您的浏览器不支持canvas！</div><div class="line"><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></div></pre></td></tr></table></figure>

<p>如果浏览器不支持这个API，则就会显示canvas标签中间的文字——“您的浏览器不支持canvas！”。</p>
<p>然后，使用JavaScript获取canvas的DOM对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> canvas = document.getElementById(<span class="string">'myCanvas'</span>);</div></pre></td></tr></table></figure>

<p>接着，检查浏览器是否支持Canvas API，方法是看有没有部署getContext方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">if</span> (canvas.getContext) {</div><div class="line">	<span class="comment">// some code here</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>使用getContext(‘2d’)方法，初始化平面图像的上下文环境。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</div></pre></td></tr></table></figure>

<p>现在就在canvas中间生成平面图像了。</p>
<h2 id="绘图方法">绘图方法</h2>
<p>（1）填充颜色</p>
<p>设置填充颜色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.fillStyle = <span class="string">"#000000"</span>; <span class="comment">// 设置填充色为黑色</span></div></pre></td></tr></table></figure>

<p>（2）绘制矩形</p>
<p>绘制实心矩形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</div></pre></td></tr></table></figure>

<p>绘制空心矩形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.strokeRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</div></pre></td></tr></table></figure>

<p>清除某个矩形区域的内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.clearRect(<span class="number">100</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">50</span>);</div></pre></td></tr></table></figure>

<p>（3）绘制路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.beginPath(); <span class="comment">// 开始路径绘制</span></div><div class="line"></div><div class="line">ctx.moveTo(<span class="number">20</span>, <span class="number">20</span>); <span class="comment">// 设置路径起点</span></div><div class="line"></div><div class="line">ctx.lineTo(<span class="number">200</span>, <span class="number">20</span>); <span class="comment">// 绘制一条到200, 20的直线</span></div><div class="line"></div><div class="line">ctx.lineWidth = <span class="number">1.0</span>; <span class="comment">// 设置线宽</span></div><div class="line"></div><div class="line">ctx.strokeStyle = <span class="string">"#CC0000"</span>; <span class="comment">// 设置线的颜色</span></div><div class="line"></div><div class="line">ctx.stroke(); <span class="comment">// 进行线的着色，这时整条线才变得可见</span></div></pre></td></tr></table></figure>

<p>moveto和lineto方法可以多次使用。最后，还可以使用closePath方法，自动绘制一条当前点到起点的直线，形成一个封闭图形，省却使用以此lineto方法。</p>
<p>（4）绘制圆形和扇形</p>
<p>绘制扇形的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.arc(x, y, radius, startAngle, endAngle, anticlockwise);</div></pre></td></tr></table></figure>

<p>arc方法的x和y参数是圆心坐标，radius是半径，startAngle和endAngle则是扇形的起始角度和终止角度（以弧度表示），anticlockwise表示做图时应该逆时针画（true）还是顺时针画（false）。</p>
<p>绘制实心的圆形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.beginPath(); </div><div class="line"></div><div class="line">ctx.arc(<span class="number">60</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>, <span class="literal">true</span>); </div><div class="line"></div><div class="line">ctx.fillStyle = <span class="string">"#000000"</span>; </div><div class="line"></div><div class="line">ctx.fill();</div></pre></td></tr></table></figure>

<p>绘制空心圆形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.beginPath(); </div><div class="line"></div><div class="line">ctx.arc(<span class="number">60</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="built_in">Math</span>.PI*<span class="number">2</span>, <span class="literal">true</span>); </div><div class="line"></div><div class="line">ctx.lineWidth = <span class="number">1.0</span>; </div><div class="line"></div><div class="line">ctx.strokeStyle = <span class="string">"#000"</span>; </div><div class="line"></div><div class="line">ctx.stroke();</div></pre></td></tr></table></figure>

<p>（5）绘制文本</p>
<p>fillText方法用于添加文本，strokeText方法用于添加空心字。使用之前，需设定字体、对齐方向、颜色等属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.font = <span class="string">"Bold 20px Arial"</span>; <span class="comment">// 设置字体</span></div><div class="line"></div><div class="line">ctx.textAlign = <span class="string">"left"</span>; <span class="comment">// 设置对齐方式</span></div><div class="line"></div><div class="line">ctx.fillStyle = <span class="string">"#008600"</span>; <span class="comment">// 设置填充颜色</span></div><div class="line"></div><div class="line">ctx.fillText(<span class="string">"Hello!"</span>, <span class="number">10</span>, <span class="number">50</span>); <span class="comment">// 设置字体内容，以及在画布上的位置</span></div><div class="line"></div><div class="line">ctx.strokeText(<span class="string">'Hello!", 10, 100); // 绘制空心字</span></div></pre></td></tr></table></figure>

<p>fillText方法不支持文本断行，即所有文本出现在一行内。所以，如果你要生成多行文本，只有调用多次fillText方法。</p>
<h3 id="渐变">渐变</h3>
<p>设置渐变色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> myGradient = ctx.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">160</span>); </div><div class="line"></div><div class="line">myGradient.addColorStop(<span class="number">0</span>, <span class="string">"#BABABA"</span>); </div><div class="line"></div><div class="line">myGradient.addColorStop(<span class="number">1</span>, <span class="string">"#636363"</span>);</div></pre></td></tr></table></figure>

<p>createLinearGradient方法的参数是(x1, y1, x2, y2)，其中x1和y1是起点坐标，x2和y2是终点坐标。通过不同的坐标值，可以生成从上至下、从左到右的渐变等等。</p>
<p>使用方法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.fillStyle = myGradient;</div><div class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</div></pre></td></tr></table></figure>

<h3 id="阴影">阴影</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.shadowOffsetX = <span class="number">10</span>; <span class="comment">// 设置水平位移</span></div><div class="line"></div><div class="line">ctx.shadowOffsetY = <span class="number">10</span>; <span class="comment">// 设置垂直位移</span></div><div class="line"></div><div class="line">ctx.shadowBlur = <span class="number">5</span>; <span class="comment">// 设置模糊度</span></div><div class="line"></div><div class="line">ctx.shadowColor = <span class="string">"rgba(0,0,0,0.5)"</span>; <span class="comment">// 设置阴影颜色</span></div><div class="line"></div><div class="line">ctx.fillStyle = <span class="string">"#CC0000"</span>; </div><div class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">200</span>,<span class="number">100</span>);</div></pre></td></tr></table></figure>

<h2 id="图像处理方法">图像处理方法</h2>
<h3 id="插入图像">插入图像</h3>
<p>canvas允许将图像文件插入画布，做法是读取图片后，使用drawImage方法在画布内进行重绘。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</div><div class="line"></div><div class="line">img.src = <span class="string">"image.png"</span>;</div><div class="line"></div><div class="line">ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 设置对应的图像对象，以及它在画布上的位置</span></div></pre></td></tr></table></figure>

<p>由于图像的载入需要时间，drawImage方法只能在图像完全载入后才能调用，因此上面的代码需要改写。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Image(); </div><div class="line"></div><div class="line">image.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> </div><div class="line"></div><div class="line">	<span class="keyword">if</span> (image.width != canvas.width)</div><div class="line">        canvas.width = image.width;</div><div class="line">    <span class="keyword">if</span> (image.height != canvas.height)</div><div class="line">        canvas.height = image.height;</div><div class="line"></div><div class="line">	ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line">    ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">} </div><div class="line"></div><div class="line">image.src = <span class="string">"image.png"</span>;</div></pre></td></tr></table></figure>

<p>drawImage()方法接受三个参数，第一个参数是图像文件的DOM元素（即img标签），第二个和第三个参数是图像左上角在Canvas元素中的坐标，上例中的（0, 0）就表示将图像左上角放置在Canvas元素的左上角。</p>
<h3 id="读取Canvas的内容">读取Canvas的内容</h3>
<p>getImageData方法可以用来读取Canvas的内容，返回一个对象，包含了每个像素的信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> imageData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div></pre></td></tr></table></figure>

<p>imageData对象有一个data属性，它的值是一个一维数组。该数组的值，依次是每个像素的红、绿、蓝、alpha通道值，因此该数组的长度等于 图像的像素宽度 x 图像的像素高度 x 4，每个值的范围是0–255。这个数组不仅可读，而且可写，因此通过操作这个数组的值，就可以达到操作图像的目的。修改这个数组以后，使用putImageData方法将数组内容重新回Canvas。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">context.putImageData(imageData, <span class="number">0</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>

<h3 id="像素处理">像素处理</h3>
<p>假定filter是一个处理像素的函数，那么整个对Canvas的处理流程，可以用下面的代码表示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">if</span> (canvas.width &gt; <span class="number">0</span> && canvas.height &gt; <span class="number">0</span>) {</div><div class="line"></div><div class="line">	<span class="keyword">var</span> imageData = context.getImageData(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</div><div class="line"></div><div class="line">    filter(imageData);</div><div class="line"></div><div class="line">    context.putImageData(imageData, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>

<p>以下是几种常见的处理方法。</p>
<p>（1）灰度效果</p>
<p>灰度图（grayscale）就是取红、绿、蓝三个像素值的算术平均值，这实际上将图像转成了黑白形式。假定d[i]是像素数组中一个象素的红色值，则d[i+1]为绿色值，d[i+2]为蓝色值，d[i+3]就是alpha通道值。转成灰度的算法，就是将红、绿、蓝三个值相加后除以3，再将结果写回数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">grayscale = <span class="function"><span class="keyword">function</span> <span class="params">(pixels)</span> {</span></div><div class="line"></div><div class="line">	<span class="keyword">var</span> d = pixels.data;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) {</div><div class="line">      <span class="keyword">var</span> r = d[i];</div><div class="line">      <span class="keyword">var</span> g = d[i + <span class="number">1</span>];</div><div class="line">      <span class="keyword">var</span> b = d[i + <span class="number">2</span>];</div><div class="line">      d[i] = d[i + <span class="number">1</span>] = d[i + <span class="number">2</span>] = (r+g+b)/<span class="number">3</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span> pixels;</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>

<p>（2）复古效果</p>
<p>复古效果（sepia）则是将红、绿、蓝三个像素，分别取这三个值的某种加权平均值，使得图像有一种古旧的效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sepia = <span class="function"><span class="keyword">function</span> <span class="params">(pixels)</span> {</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> d = pixels.data;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) {</div><div class="line">      <span class="keyword">var</span> r = d[i];</div><div class="line">      <span class="keyword">var</span> g = d[i + <span class="number">1</span>];</div><div class="line">      <span class="keyword">var</span> b = d[i + <span class="number">2</span>];</div><div class="line">      d[i]     = (r * <span class="number">0.393</span>)+(g * <span class="number">0.769</span>)+(b * <span class="number">0.189</span>); <span class="comment">// red</span></div><div class="line">      d[i + <span class="number">1</span>] = (r * <span class="number">0.349</span>)+(g * <span class="number">0.686</span>)+(b * <span class="number">0.168</span>); <span class="comment">// green</span></div><div class="line">      d[i + <span class="number">2</span>] = (r * <span class="number">0.272</span>)+(g * <span class="number">0.534</span>)+(b * <span class="number">0.131</span>); <span class="comment">// blue</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span> pixels;</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>

<p>（3）红色蒙版效果</p>
<p>红色蒙版指的是，让图像呈现一种偏红的效果。算法是将红色通道设为红、绿、蓝三个值的平均值，而将绿色通道和蓝色通道都设为0。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">red = <span class="function"><span class="keyword">function</span> <span class="params">(pixels)</span> {</span></div><div class="line">	</div><div class="line">    <span class="keyword">var</span> d = pixels.data;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) {</div><div class="line">      <span class="keyword">var</span> r = d[i];</div><div class="line">      <span class="keyword">var</span> g = d[i + <span class="number">1</span>];</div><div class="line">      <span class="keyword">var</span> b = d[i + <span class="number">2</span>];</div><div class="line">      d[i] = (r+g+b)/<span class="number">3</span>;        <span class="comment">// 红色通道取平均值</span></div><div class="line">      d[i + <span class="number">1</span>] = d[i + <span class="number">2</span>] = <span class="number">0</span>; <span class="comment">// 绿色通道和蓝色通道都设为0</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span> pixels;</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>

<p>（4）亮度效果</p>
<p>亮度效果（brightness）是指让图像变得更亮或更暗。算法将红色通道、绿色通道、蓝色通道，同时加上一个正值或负值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">brightness = <span class="function"><span class="keyword">function</span> <span class="params">(pixels, delta)</span> {</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> d = pixels.data;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) {</div><div class="line">          d[i] += delta;     <span class="comment">// red</span></div><div class="line">          d[i + <span class="number">1</span>] += delta; <span class="comment">// green</span></div><div class="line">          d[i + <span class="number">2</span>] += delta; <span class="comment">// blue   </span></div><div class="line">    }</div><div class="line"></div><div class="line">	<span class="keyword">return</span> pixels;</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>

<p>（5）反转效果</p>
<p>反转效果（invert）是值图片呈现一种色彩颠倒的效果。算法为红、绿、蓝通道都取各自的相反值（255-原值）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">invert = <span class="function"><span class="keyword">function</span> <span class="params">(pixels)</span> {</span></div><div class="line"></div><div class="line">	<span class="keyword">var</span> d = pixels.data;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; d.length; i += <span class="number">4</span>) {</div><div class="line">		d[i] = <span class="number">255</span> - d[i];</div><div class="line">		d[i+<span class="number">1</span>] = <span class="number">255</span> - d[i + <span class="number">1</span>];</div><div class="line">		d[i+<span class="number">2</span>] = <span class="number">255</span> - d[i + <span class="number">2</span>];</div><div class="line">	}</div><div class="line"></div><div class="line">	<span class="keyword">return</span> pixels;</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>

<h3 id="将Canvas转化为图像文件">将Canvas转化为图像文件</h3>
<p>对图像数据做出修改以后，可以使用toDataURL方法，将Canvas数据重新转化成一般的图像文件形式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">convertCanvasToImage</span><span class="params">(canvas)</span> {</span></div><div class="line">  <span class="keyword">var</span> image = <span class="keyword">new</span> Image();</div><div class="line">  image.src = canvas.toDataURL(<span class="string">"image/png"</span>);</div><div class="line">  <span class="keyword">return</span> image;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>上面的代码将Canvas数据，转化成PNG data URI。</p>
<h2 id="保存和恢复上下文">保存和恢复上下文</h2>
<p>save方法用于保存上下文环境，restore方法用于恢复到上一次保存的上下文环境。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ctx.save(); </div><div class="line"></div><div class="line">ctx.shadowOffsetX = <span class="number">10</span>;</div><div class="line">ctx.shadowOffsetY = <span class="number">10</span>;</div><div class="line">ctx.shadowBlur = <span class="number">5</span>;</div><div class="line">ctx.shadowColor = <span class="string">"rgba(0,0,0,0.5)"</span>;</div><div class="line"></div><div class="line">ctx.fillStyle = <span class="string">"#CC0000"</span>;</div><div class="line">ctx.fillRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">150</span>,<span class="number">100</span>);</div><div class="line"></div><div class="line">ctx.restore(); </div><div class="line"></div><div class="line">ctx.fillStyle = <span class="string">"#000000"</span>;</div><div class="line">ctx.fillRect(<span class="number">180</span>,<span class="number">10</span>,<span class="number">150</span>,<span class="number">100</span>);</div></pre></td></tr></table></figure>

<p>上面的代码一共绘制了两个矩形，前一个有阴影，后一个没有。</p>
<h2 id="参考链接">参考链接</h2>
<ul>
<li>David Walsh, <a href="http://davidwalsh.name/convert-canvas-image" target="_blank" rel="external">JavaScript Canvas Image Conversion</a></li>
<li>Matt West, <a href="http://blog.teamtreehouse.com/getting-started-with-the-canvas-api" target="_blank" rel="external">Getting Started With The Canvas API</a></li>
<li>John Robinson, <a href="http://www.storminthecastle.com/2013/04/06/how-you-can-do-cool-image-effects-using-html5-canvas/" target="_blank" rel="external">How You Can Do Cool Image Effects Using HTML5 Canvas</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/07/16/canvas/" data-id="nncbniw8ybdntd28" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Tcl/">Tcl</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/feeling/">feeling</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07">July 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01">January 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/07/16/why-we-droped-our-dream/">我们为何渐渐放弃了自己的梦想</a>
          </li>
        
          <li>
            <a href="/2014/07/16/canvas/">Canvas API</a>
          </li>
        
          <li>
            <a href="/2014/07/16/basic-network/">网络入门</a>
          </li>
        
          <li>
            <a href="/2014/07/16/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2014/07/16/using-nodejs-webkit/">Using nodejs to develop desktop app</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Tony Wang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>